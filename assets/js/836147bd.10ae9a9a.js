"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5373],{3905:function(e,a,n){n.r(a),n.d(a,{MDXContext:function(){return l},MDXProvider:function(){return c},mdx:function(){return f},useMDXComponents:function(){return d},withMDXComponents:function(){return p}});var r=n(67294);function t(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function m(){return m=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(this,arguments)}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){t(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function s(e,a){if(null==e)return{};var n,r,t=function(e,a){if(null==e)return{};var n,r,t={},m=Object.keys(e);for(r=0;r<m.length;r++)n=m[r],a.indexOf(n)>=0||(t[n]=e[n]);return t}(e,a);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(r=0;r<m.length;r++)n=m[r],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var l=r.createContext({}),p=function(e){return function(a){var n=d(a.components);return r.createElement(e,m({},a,{components:n}))}},d=function(e){var a=r.useContext(l),n=a;return e&&(n="function"==typeof e?e(a):i(i({},a),e)),n},c=function(e){var a=d(e.components);return r.createElement(l.Provider,{value:a},e.children)},h={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},u=r.forwardRef((function(e,a){var n=e.components,t=e.mdxType,m=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=d(n),c=t,u=p["".concat(o,".").concat(c)]||p[c]||h[c]||m;return n?r.createElement(u,i(i({ref:a},l),{},{components:n})):r.createElement(u,i({ref:a},l))}));function f(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var m=n.length,o=new Array(m);o[0]=u;var i={};for(var s in a)hasOwnProperty.call(a,s)&&(i[s]=a[s]);i.originalType=e,i.mdxType="string"==typeof e?e:t,o[1]=i;for(var l=2;l<m;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},30648:function(e,a,n){n.r(a),n.d(a,{assets:function(){return p},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return d}});var r=n(83117),t=n(80102),m=(n(67294),n(3905)),o=["components"],i={id:"world",title:"Worlds and Variables",sidebar_label:"Worlds and Variables",slug:"/world"},s=void 0,l={unversionedId:"framework_topics/world",id:"framework_topics/world",title:"Worlds and Variables",description:"Worlds",source:"@site/../docs/framework_topics/world.md",sourceDirName:"framework_topics",slug:"/world",permalink:"/docs/world",draft:!1,editUrl:"https://github.com/facebookresearch/beanmachine/edit/main/website/../docs/framework_topics/world.md",tags:[],version:"current",frontMatter:{id:"world",title:"Worlds and Variables",sidebar_label:"Worlds and Variables",slug:"/world"},sidebar:"someSidebar",previous:{title:"Installation",permalink:"/docs/overview/installation/"},next:{title:"Overview",permalink:"/docs/mcmc_inference"}},p={},d=[{value:"Worlds",id:"worlds",level:2},{value:"Variables",id:"variables",level:2},{value:"RVIdentifiers",id:"rvidentifiers",level:2}],c={toc:d};function h(e){var a=e.components,n=(0,t.Z)(e,o);return(0,m.mdx)("wrapper",(0,r.Z)({},c,n,{components:a,mdxType:"MDXLayout"}),(0,m.mdx)("h2",{id:"worlds"},"Worlds"),(0,m.mdx)("p",null,"A ",(0,m.mdx)("a",{parentName:"p",href:"https://beanmachine.org/api/beanmachine.ppl.world.html"},(0,m.mdx)("inlineCode",{parentName:"a"},"World"))," is Bean Machine's internal representation of the state of the model.  It can be thought of as a graph corresponding to a particular instantiation of the graphical model, or mathematically, a sample from the joint distribution of the model: ",(0,m.mdx)("span",{parentName:"p",className:"math math-inline"},(0,m.mdx)("span",{parentName:"span",className:"katex"},(0,m.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,m.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.mdx)("semantics",{parentName:"math"},(0,m.mdx)("mrow",{parentName:"semantics"},(0,m.mdx)("mi",{parentName:"mrow"},"w"),(0,m.mdx)("mi",{parentName:"mrow"},"o"),(0,m.mdx)("mi",{parentName:"mrow"},"r"),(0,m.mdx)("mi",{parentName:"mrow"},"l"),(0,m.mdx)("mi",{parentName:"mrow"},"d"),(0,m.mdx)("mo",{parentName:"mrow"},"\u223c"),(0,m.mdx)("mi",{parentName:"mrow"},"p"),(0,m.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,m.mdx)("mi",{parentName:"mrow"},"d"),(0,m.mdx)("mi",{parentName:"mrow"},"a"),(0,m.mdx)("mi",{parentName:"mrow"},"t"),(0,m.mdx)("mi",{parentName:"mrow"},"a"),(0,m.mdx)("mo",{parentName:"mrow",separator:"true"},","),(0,m.mdx)("mi",{parentName:"mrow"},"r"),(0,m.mdx)("mi",{parentName:"mrow"},"a"),(0,m.mdx)("mi",{parentName:"mrow"},"n"),(0,m.mdx)("mi",{parentName:"mrow"},"d"),(0,m.mdx)("mi",{parentName:"mrow"},"o"),(0,m.mdx)("mi",{parentName:"mrow"},"m"),(0,m.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"_"),(0,m.mdx)("mi",{parentName:"mrow"},"v"),(0,m.mdx)("mi",{parentName:"mrow"},"a"),(0,m.mdx)("mi",{parentName:"mrow"},"r"),(0,m.mdx)("mi",{parentName:"mrow"},"i"),(0,m.mdx)("mi",{parentName:"mrow"},"a"),(0,m.mdx)("mi",{parentName:"mrow"},"b"),(0,m.mdx)("mi",{parentName:"mrow"},"l"),(0,m.mdx)("mi",{parentName:"mrow"},"e"),(0,m.mdx)("mi",{parentName:"mrow"},"s"),(0,m.mdx)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,m.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"world \\sim p(data, random\\_variables)")))),(0,m.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02691em"}},"w"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"o"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,m.mdx)("span",{parentName:"span",className:"mrel"},"\u223c"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"1.06em",verticalAlign:"-0.31em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,m.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,m.mdx)("span",{parentName:"span",className:"mpunct"},","),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"n"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"o"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,m.mdx)("span",{parentName:"span",className:"mord",style:{marginRight:"0.02778em"}},"_"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"i"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"b"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,m.mdx)("span",{parentName:"span",className:"mord mathnormal"},"s"),(0,m.mdx)("span",{parentName:"span",className:"mclose"},")"))))),".\nWhen we run inference, we create worlds, each of which corresponds to a Monte Carlo sample of the posterior. New worlds are either accepted or rejected, which is (usually) determined by the accept-reject stage of\nthe MH algorithm."),(0,m.mdx)("p",null,"The ",(0,m.mdx)("inlineCode",{parentName:"p"},"World")," class provides a flexible interface for performing inference and representing the intermediate or final results of inference. To that end, it provides a few functionalities.\nSince a world is a representation of the model joint, it tracks which variables are latent and which are observed, and we can evaluate its density with its ",(0,m.mdx)("inlineCode",{parentName:"p"},"log_prob")," method which returns the\njoint log probability given its instantiated variables.\nA world can also be run as a ",(0,m.mdx)("a",{parentName:"p",href:"https://docs.python.org/3/library/contextlib.html"},"Python context manager")," which allows the user to execute a model given a particular instantiation of a world.\nOrdinarily, a ",(0,m.mdx)("inlineCode",{parentName:"p"},"random_variable")," returns a function pointer to the variable, but under the world context, the actual variable is sampled since we are instantiating it inside a world:"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-py"},"@bm.random_variable\ndef foo():\n    return Bernoulli(0.5)\n\npointer = foo()\nassert isinstance(pointer, RVIdentifier)\n\nworld = World()\n# everything run inside the world context manager\n# is recorded in the world\nwith world:\n    x = foo()\n\nx == torch.tensor(1.)\nx_var = world.get_variable(foo())\nx_var.value == x\n")),(0,m.mdx)("p",null,"Since worlds are independent instantiations of the model, you can compose them interchangeably.  This allows us to inspect and manipulate our model as we see fit.\nDuring MCMC inference, Bean Machine is constantly proposing new worlds in accordance with the proposal distribution, the collection of which form the posterior."),(0,m.mdx)("h2",{id:"variables"},"Variables"),(0,m.mdx)("p",null,(0,m.mdx)("inlineCode",{parentName:"p"},"Variables")," are primitives that contain metadata about a given random variable defined by ",(0,m.mdx)("inlineCode",{parentName:"p"},"@bm.random_variable"),", such as the distribution it was sampled from, its parents and children, the sampled value of the variable, and its log density.  They can represent latent or observed variables.  Only latent variables are inferred during inference and the values of the Variables can change between inference iterations."),(0,m.mdx)("h2",{id:"rvidentifiers"},"RVIdentifiers"),(0,m.mdx)("p",null,"Each ",(0,m.mdx)("a",{parentName:"p",href:"https://beanmachine.org/docs/overview/modeling/#random-variable-functions"},"random variable")," is associated with a unique key ",(0,m.mdx)("inlineCode",{parentName:"p"},"RVidentifier"),". This is a pointer to the random variable and is implemented as a dataclass containing the random variable's Python function and arguments.\nSince the function argument is a component of generating an ",(0,m.mdx)("inlineCode",{parentName:"p"},"RVIdentifier"),", the same callable can generate independent random variables by using different arguments:"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-py"},"@bm.random_variable\ndef foo(i):\n  return Normal(0., 1.)\n\nfoo(0)  # this is one variable with an RVIdentifier\nfoo(1)  # this is another variable with a different RVIdentifier\n")))}h.isMDXComponent=!0}}]);